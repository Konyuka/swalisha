import{j as e,T as i,a3 as T,a4 as z,k as p,U as C,B as k,z as $,a2 as E,g as G,r as l,E as U,ai as Y,m as I,S as W,y as B,bl as X,n as y,F as D,G as J,M as w,u as M,s as Z,a5 as ee,a6 as H,t as se,v as O,au as te,an as K,K as ae,al as ne,D as ie,w as re,ae as oe,O as ce,b as Q,i as le,A as de,av as me,h as ue,aE as xe,aw as he,aG as ge,aF as je,X as pe,a1 as fe}from"./main-0be1d019.js";import{H as P}from"./hc-routes-c96dda40.js";import{a as ye,S as be,m as Se,f as ve,c as ke,T as Ne,I as we,u as Te,l as Ce}from"./use-create-ticket-5b9f3565.js";import{T as Ie,D as Pe,a as qe,R as V,A as Re,F as Fe,j as Ae,x as _,g as Le}from"./reply-editor-b3f60ce1.js";import{s as _e}from"./search-a322569b.js";import{B as q,a as h}from"./breadcrumb-9f769b36.js";import{R as ze}from"./Reply-1872c748.js";import{u as Ee}from"./search-trigger-button-19794863.js";import{S as Be}from"./section-helper-64d68e03.js";import"./bullet-seprated-items-25a8819d.js";import"./AttachFile-577a01ff.js";import"./Edit-75236d4e.js";const De=[{key:"subject",visibleInMode:"all",header:()=>e.jsx(i,{message:"Subject"}),body:s=>s.subject,width:"flex-3 min-w-200"},{key:"id",allowsSorting:!0,header:()=>e.jsx(i,{message:"Id"}),width:"w-90",body:s=>`#${s.id}`},{key:"created_at",allowsSorting:!0,header:()=>e.jsx(i,{message:"Created"}),width:"w-144",body:s=>e.jsx(T,{date:s.created_at})},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(i,{message:"Last updated"}),width:"w-144",body:s=>e.jsx(T,{date:s.updated_at})},{key:"status",allowsSorting:!0,header:()=>e.jsx(i,{message:"Status"}),visibleInMode:"all",width:"w-80",body:s=>e.jsx("div",{className:"w-max",children:e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded-md",className:"font-medium capitalize",children:e.jsx(i,{message:s.status})})})}],Me="1",He="20";function Oe(){const s=p();return e.jsxs("div",{children:[e.jsx(C,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("main",{className:"container mx-auto px-24 pb-48",children:[e.jsxs(q,{size:"sm",className:"mb-48 mt-34",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(i,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(i,{message:"Requests"})})]}),e.jsxs("div",{className:"mb-34 flex items-start justify-between gap-12",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:e.jsx(i,{message:"My requests"})}),e.jsx(k,{elementType:$,to:"/hc/tickets/new",size:"sm",variant:"outline",children:e.jsx(i,{message:"New request"})})]}),e.jsx(Ke,{})]})]})}function Ke(){var v,f;const[s,t]=E(),{trans:a}=G(),n=l.useRef(null),u=p(),{user:r}=U(),[c,g]=l.useState({}),d=ye({userId:r.id,query:s.get("query"),tagId:s.get("tagId"),page:s.get("page")||Me,perPage:s.get("perPage")||He,...c}),j=((f=(v=d.data)==null?void 0:v.pagination)==null?void 0:f.data)||[],N=!!s.get("query")||!!s.get("tagId"),b=()=>{t(m=>{var x;return(x=n.current)!=null&&x.value?m.set("query",n.current.value):m.delete("query"),m})},S=j.length?e.jsxs(l.Fragment,{children:[e.jsx(Ie,{columns:De,data:j,sortDescriptor:c,onSortChange:g,enableSelection:!1,onAction:m=>u(`/hc/tickets/${m.id}`),cellHeight:"h-60"}),e.jsx(Pe,{className:"mt-12",query:d,onPageChange:m=>t(x=>(x.set("page",m.toString()),x))})]}):e.jsx(Qe,{isFiltering:N});return e.jsxs(l.Fragment,{children:[e.jsxs("form",{className:"mb-34 items-end justify-between gap-24 md:flex",onSubmit:m=>{m.preventDefault(),b()},children:[e.jsx(Y,{className:"flex-auto max-md:mb-24",inputRef:n,defaultValue:s.get("query")||"",onBlur:()=>b(),placeholder:a(I("Search requests")),startAdornment:e.jsx(W,{})}),e.jsx(Ve,{})]}),e.jsx(B,{initial:!1,mode:"wait",children:d.isLoading?e.jsx($e,{}):S})]})}function Qe({isFiltering:s}){return e.jsx(qe,{isFiltering:s,size:"sm",className:"mt-48",image:_e,title:e.jsx(i,{message:"You have not created any requests yet"}),filteringTitle:e.jsx(i,{message:"No requests match your search query or filters"})})}function Ve(){const[s,t]=E();return e.jsxs(X,{className:"flex-shrink-0 md:min-w-172",selectionMode:"single",selectedValue:s.get("tagId")||"",onSelectionChange:a=>{t(n=>(a?n.set("tagId",`${a}`):n.delete("tagId"),n))},children:[e.jsx(y,{value:"",children:e.jsx(i,{message:"All requests"})}),e.jsx(y,{value:"open",children:e.jsx(i,{message:"Open requests"})}),e.jsx(y,{value:"closed",children:e.jsx(i,{message:"Closed requests"})}),e.jsx(y,{value:"pending",children:e.jsx(i,{message:"Awaiting your reply"})})]})}function $e(){return e.jsxs(D.div,{...J,children:[e.jsx(w,{size:"h-36",variant:"rect",className:"mb-12"}),e.jsx(w,{size:"h-54",variant:"rect",className:"mb-12"}),e.jsx(w,{size:"h-54",variant:"rect"})]},"skeletons")}function Ge(){const{ticketId:s}=M();return Z({mutationFn:t=>Ue({ticketId:s,...t}),onSuccess:async()=>{await ee.invalidateQueries({queryKey:["tickets"]}),H(I("Reply submitted"))},onError:t=>se(t)})}function Ue(s){var a;const t={body:s.body,attachments:(a=s.attachments)==null?void 0:a.map(n=>n.id)};return O.post(`tickets/${s.ticketId}/replies`,t).then(n=>n.data)}function Ye(){const s=p();return e.jsxs("div",{children:[e.jsx(C,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(q,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(i,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(i,{message:"Requests"})}),e.jsx(h,{children:e.jsx(i,{message:"Current ticket"})})]}),e.jsx("main",{children:e.jsx(We,{})})]})]})}function We(){const s=te(),[t,a]=l.useState(!1);return Ee("window","r",()=>a(!0)),e.jsx(l.Fragment,{children:s.data?e.jsxs(l.Fragment,{children:[s.data.ticket.status==="locked"&&e.jsx(Be,{className:"mb-44 text-center",color:"danger",title:e.jsx(i,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),e.jsx(Je,{ticket:s.data.ticket,editorIsOpen:t,onOpenEditor:()=>a(!0)}),e.jsx(K,{children:t&&e.jsx(Xe,{onClose:()=>a(!1)})}),e.jsx(Ze,{data:s.data})]}):e.jsx(ae,{query:s,loaderClassName:"absolute inset-0 m-auto"})})}function Xe({onClose:s}){const t=l.useRef(null),a=Ge(),[n,u]=l.useState([]);return e.jsx(V,{isLoading:a.isPending,footerButtons:e.jsx(be,{}),editorRef:t,className:"mb-24",attachments:n,onAttachmentsChange:r=>u(r),onSubmit:r=>a.mutate(r,{onSuccess:()=>s()})})}function Je({ticket:s,onOpenEditor:t,editorIsOpen:a}){return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"flex items-center gap-24",children:[e.jsxs("div",{className:"whitespace-nowrap text-muted max-md:hidden",children:[e.jsx(T,{date:s.created_at})," (",e.jsx(ne,{date:s.created_at,options:Se}),")"]}),e.jsxs("div",{className:"text-2xl md:ml-auto",children:["#",s.id]}),e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded",className:"min-w-60 font-bold capitalize",children:s.status})]}),e.jsx("h1",{className:"my-12 text-2xl",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(ve,{ticket:s,tagType:"category",size:"sm",radius:"rounded",className:"mr-auto font-semibold max-md:hidden"}),!s.closed_at&&e.jsx(ss,{}),e.jsx(k,{size:"sm",variant:"outline",startIcon:e.jsx(ze,{}),disabled:a,onClick:()=>t(),children:e.jsx(i,{message:"Add a reply"})})]})]})}function Ze({data:{ticket:s,replies:t}}){const a=ke(s.id,t);return e.jsxs(l.Fragment,{children:[a.items.map(n=>{var r,c;const u=!a.hasNextPage&&n.id===((r=a.items.at(-1))==null?void 0:r.id);return e.jsx(Ne,{className:"px-12",reply:n,isInitial:u,attachments:(c=n.attachments)!=null&&c.length?e.jsx(es,{attachments:n.attachments}):null},n.id)}),e.jsx(we,{query:a})]})}function es({attachments:s}){return e.jsx(Re,{className:"mt-30 w-max",children:s.map((t,a)=>e.jsx(Fe,{attachments:s,index:a},t.id))})}function ss(){const s=Te(),{ticketId:t}=M(),a=p();return e.jsxs(ie,{type:"modal",children:[e.jsx(k,{size:"sm",variant:"outline",startIcon:e.jsx(re,{}),children:e.jsx(i,{message:"Mark as solved"})}),({close:n})=>e.jsx(oe,{onConfirm:()=>{s.mutate({ids:[t],status:"closed"},{onSuccess:()=>{n(),H(I("Ticked marked as solved")),a("/hc/tickets")}})},isLoading:s.isPending,title:e.jsx(i,{message:"Mark as solved"}),body:e.jsx(i,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:e.jsx(i,{message:"Confirm"})})]})}function ts(){return ce({queryKey:["new-ticket-categories"],queryFn:()=>as()})}function as(){return O.get("ticket-categories",{params:{perPage:25,with:"categories",orderBy:"name",orderDir:"asc",filterByPurchases:!0,paginate:"simple"}}).then(s=>s.data)}function R(){var t,a;return((a=(t=Q().hc)==null?void 0:t.newTicket)==null?void 0:a.appearance)||{}}function ns({query:s,suggestionLog:t,hcCategoryIds:a}){const n=Ae(),u=d=>{d.pagination.data.length&&t.current.push({term:d.query,results:d.pagination.data.map(j=>j.id),date:n.toAbsoluteString()})},{data:r}=le(s,{perPage:5,categoryIds:a},{onSearch:u}),c=r==null?void 0:r.pagination.data,g=!!(c!=null&&c.length);return e.jsx(B,{children:e.jsxs(D.div,{variants:_.variants,transition:_.transition,initial:!1,animate:g?"open":"closed",children:[e.jsxs("div",{className:"mb-10 mt-24 text-xl font-semibold",children:[e.jsx(i,{message:"Were you looking for"}),":"]}),c==null?void 0:c.map(d=>e.jsx(de,{article:d,className:"block py-10 text-sm text-primary",target:"_blank"},d.id))]},"drawer")})}function is(){const s=p(),t=R(),a=ts(),{envato:n}=Q();return e.jsxs("div",{children:[e.jsx(C,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(q,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(i,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(i,{message:"Requests"})}),e.jsx(h,{children:e.jsx(i,{message:"New request"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"flex-auto",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(i,{message:t.title})}),a.error&&(n==null?void 0:n.enable)&&n.require_purchase_code&&e.jsx(ls,{}),a.data?e.jsx(rs,{ticketCategories:a.data.pagination.data}):null]}),e.jsx(os,{})]})]})]})}function rs({ticketCategories:s}){var F,A,L;const t=R(),a=p(),n=me({defaultValues:{category_id:(F=s[0])==null?void 0:F.id}}),u=(A=n.formState.errors.body)==null?void 0:A.message,r=Ce(n),c=l.useRef(null),[g,d]=l.useState([]),j=n.watch("subject"),N=(L=s.find(o=>n.watch("category_id")==o.id))==null?void 0:L.categories.map(o=>o.id),b=ue(),S=l.useRef([]),v=n.watch("category_id"),f=s.find(o=>o.id==v),m=()=>{r.mutate({...n.getValues(),body:Le(c)||"",attachments:g.map(o=>o.id),suggestionLog:S.current},{onSuccess:()=>{b.updateLastSearch({createdTicket:!0}),a("/hc/tickets")}})},x=xe();return e.jsxs(he,{form:n,onSubmit:()=>m(),onBeforeSubmit:()=>n.clearErrors(),children:[e.jsx(ge,{name:"category_id",label:e.jsx(i,{message:t.categoryLabel}),selectionMode:"single",className:"mb-24",errorMessage:f&&f.support_expired&&e.jsx(i,{message:"Your support for this item has expired. <a>Click here to renew</a>",values:{a:o=>e.jsx("a",{href:"https://codecanyon.net/downloads",target:"_blank",rel:"noreferrer",className:"font-bold underline",children:o})}}),children:s.map(o=>e.jsx(y,{value:o.id,children:o.display_name||o.name},o.id))}),e.jsx(je,{name:"subject",label:e.jsx(i,{message:t.subjectLabel})}),e.jsx(ns,{query:j,suggestionLog:S,hcCategoryIds:N}),e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:x.label,children:e.jsx(i,{message:t.descriptionLabel})}),e.jsx(K,{children:e.jsx(V,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:r.isPending,editorRef:c,attachments:g,onAttachmentsChange:o=>d(o),onSubmit:()=>m()})}),u&&e.jsx("div",{className:x.error,children:u})]}),e.jsx(k,{variant:"flat",color:"primary",type:"submit",disabled:r.isPending,children:e.jsx(i,{message:t.submitButtonText})})]})}function os(){var t;const s=R();return e.jsxs("aside",{className:"w-500 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(i,{message:s.sidebarTitle})}),(t=s.sidebarTips)==null?void 0:t.map((a,n)=>e.jsx(cs,{title:e.jsx(i,{message:a.title}),children:e.jsx(i,{message:a.content})},n))]})}function cs({title:s,children:t}){return e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{children:t})]})}function ls(){return e.jsx("div",{className:"text-sm text-danger",children:e.jsx(i,{message:"There was an issue fetching your purchase codes from envato. Try to logout and use 'login with envato' button."})})}const ds=[{path:"/",element:e.jsx(Oe,{})},{path:"/new",element:e.jsx(is,{})},{path:":ticketId",element:e.jsx(Ye,{})},{path:"*",element:e.jsx(fe,{})}];function ks(){return pe(ds)}export{ks as default};
//# sourceMappingURL=hc-ticket-routes-5a2443ce.js.map
