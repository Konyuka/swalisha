import{a2 as q,k as F,r as d,j as e,T as r,a3 as ls,a4 as je,Q as Ws,z as P,c as w,O as X,v as b,s as C,a5 as k,a6 as _,m as g,t as N,a7 as ie,I as D,B as h,a8 as re,a9 as O,aa as pe,ab as $,n as j,D as Y,g as fe,f as A,d as K,ac as G,e as Q,l as os,ad as Z,ae as ce,af as Gs,F as W,V as Pe,W as ds,y as ee,ag as us,G as J,M as Fe,ah as Js,x as ms,U as Xs,ai as Ys,S as xs,aj as gs,ak as ze,al as z,i as hs,o as js,R as Zs,p as ps,u as B,b as se,am as Re,an as ye,ao as R,a0 as et,ap as st,aq as tt,ar as at,as as nt,J as it,at as rt,A as ct,au as Ee,K as be,av as ve,aw as ke,ax as lt,ay as ot,E as fs,az as dt,aA as ut,aB as mt,aC as xt,aD as gt,aE as ht,aF as Se,aG as he,aH as ys,aI as jt,aJ as pt,C as ft,aK as yt,aL as bt,aM as vt,aN as kt,X as St,aO as ss,a1 as wt}from"./main-0be1d019.js";import{U as Me,u as Lt,a as qe,b as E,c as bs,T as De,I as Oe,d as Tt,e as vs,f as ks,g as Ct,h as Nt,i as _e,t as y,j as Ss,S as It,k as Dt,l as _t}from"./use-create-ticket-5b9f3565.js";import{D as $e,C as Be,T as Ue,a as At,R as we,g as Le,A as ws,F as Ls,i as Pt}from"./reply-editor-b3f60ce1.js";import{u as Ft,D as Ts,G as Ke,F as me,a as xe,c as zt,b as Rt,t as Et,U as ts,A as Mt,d as qt,T as Cs,e as Ns,f as Ae,N as Ot,B as $t,M as Bt,g as Qe,C as Ut,h as Kt,i as Qt,j as Is,I as Ds,k as Ht,S as Vt}from"./search-report-table-f0bbbc10.js";import{u as H,S as Wt}from"./search-trigger-button-19794863.js";import{a as _s,b as As,c as He,d as Ps,s as Fs,u as Gt,D as Jt}from"./search-a322569b.js";import{I as Xt,F as Yt,K as Zt,E as ea,C as sa}from"./Comment-1f6b3e75.js";import{R as ta}from"./Reply-1872c748.js";import{M as aa}from"./Edit-75236d4e.js";const na=""+new URL("opened-bde6b15c.svg",import.meta.url).href,zs="1",Rs="20";function te(){const[s]=q();return{tagId:s.get("tagId")||"unassigned",page:s.get("page")||zs,perPage:s.get("perPage")||Rs,orderBy:s.get("orderBy")||"",orderDir:s.get("orderDir")||""}}function Es(){const s=F(),t=te();return d.useCallback((a={})=>{const n=Ms(t,a);s(n)},[t,s])}function ia(s={}){const t=te();return Ms(t,s)}function Ms(s,t={}){const a=t.tagId||s.tagId,n=`${t.page||s.page}`,i=`${t.perPage||s.perPage}`,c="orderBy"in t?t.orderBy:s.orderBy,l="orderDir"in t?t.orderDir:s.orderDir;let o=`/agent/tickets?tagId=${a}`;return n!==zs&&(o+=`&page=${n}`),i!==Rs&&(o+=`&perPage=${i}`),c&&(o+=`&orderBy=${c}`),l&&(o+=`&orderDir=${l}`),o}function ra({onPageChange:s,onPerPageChange:t,query:a}){return e.jsx($e,{className:"flex-shrink-0",onPerPageChange:t,onPageChange:s,query:a})}const ca=[{key:"user_id",allowsSorting:!0,header:()=>e.jsx(r,{message:"Customer"}),visibleInMode:"all",width:"w-132",body:s=>s.user?s.user.display_name:"-"},{key:"avatar",header:()=>e.jsx(r,{message:"Avatar"}),hideHeader:!0,width:"w-100 flex-shrink-0",body:s=>s.user?e.jsx("img",{className:"m-auto h-38 w-38 rounded-full",src:s.user.avatar,alt:""}):"-"},{key:"summary",header:()=>e.jsx(r,{message:"Ticket summary"}),body:s=>e.jsx(la,{ticket:s}),width:"flex-3 min-w-200"},{key:"replies_count",header:()=>e.jsx(r,{message:"Replies count"}),hideHeader:!0,width:"w-50",body:s=>e.jsx("div",{className:"w-max rounded border bg-alt px-6 text-xs font-normal text-muted",children:s.replies_count||1})},{key:"assigned_to",allowsSorting:!0,header:()=>e.jsx(r,{message:"Assigned to"}),width:"w-124",body:s=>s.assignee?s.assignee.display_name:""},{key:"id",allowsSorting:!0,header:()=>e.jsx(r,{message:"Number"}),width:"w-90",body:s=>s.id},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(r,{message:"Last updated"}),visibleInMode:"all",width:"w-144",body:s=>e.jsx(ls,{date:s.updated_at})}];function la({ticket:s}){var n,i,c,l;const t=(n=s.latest_reply)!=null&&n.body?s.latest_reply.body:(c=(i=s.replies)==null?void 0:i[0])==null?void 0:c.body,a=(l=s.tags)==null?void 0:l.filter(o=>o.type!=="status");return e.jsxs("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap pr-12",children:[e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx(Be,{size:"xs",wrap:!1,children:a==null?void 0:a.map(o=>e.jsx(je,{children:o.display_name||o.name},o.id))}),e.jsx("div",{children:s.subject})]}),t&&e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap pt-4 font-normal text-muted",children:t})]})}function oa({ticket:s,className:t,children:a,color:n="inherit",...i}){const c=d.useMemo(()=>Te(s),[s]);return e.jsx(P,{...i,className:w(n==="primary"?"text-primary hover:text-primary-dark":"text-inherit","overflow-x-hidden overflow-ellipsis outline-none transition-colors hover:underline focus-visible:underline",t),to:c,children:a??s.subject})}function Te(s,{absolute:t,tagId:a}={}){let n=`/agent/tickets/${s.id}`;return t&&(n=`${Ws().settings.base_url}${n}`),a&&(n=`${n}?tagId=${a}`),n}function Ve({query:s,selectedTickets:t,onSelectionChange:a,sortDescriptor:n,onSortChange:i}){var o;const c=F(),{tagId:l}=te();return e.jsx(Ue,{headerCellHeight:"h-36",cellHeight:"h-64",selectedRows:t,onSelectionChange:u=>a==null?void 0:a(u),columns:ca,data:((o=s.data)==null?void 0:o.pagination.data)||[],renderRowAs:da,onAction:u=>c(Te(u,{tagId:l})),sortDescriptor:n,onSortChange:i})}function da({children:s,item:t,className:a,...n}){return e.jsx("div",{className:w(a,t.status==="open"&&"font-semibold",t.closed_at&&"bg-alt"),...n,children:s})}const ua="tickets.update",ma="ticket";function xa(){return X({queryKey:["users","agents"],queryFn:()=>ga()})}function ga(){return b.get("users",{params:{permission:ua,perPage:20}}).then(s=>s.data)}function ha(){return C({mutationFn:s=>ja(s),onSuccess:async()=>{await Promise.allSettled([k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),k.invalidateQueries({queryKey:["tickets"]})]),_(g("Tickets reassigned"))},onError:s=>N(s)})}function ja(s){return b.post("tickets/assign",s).then(t=>t.data)}const ae=d.forwardRef(({startIcon:s,endIcon:t,children:a,color:n,isCompact:i=!1,...c},l)=>i?e.jsx(ie,{label:a,ref:l,children:e.jsx(D,{color:n,iconSize:"md",size:"sm",...c,children:s})}):e.jsx(h,{startIcon:s,endIcon:t,variant:"outline",color:n,size:"xs",ref:l,...c,children:a})),pa=re(e.jsx("path",{d:"M 16 5 C 12.145852 5 9 8.1458513 9 12 C 9 14.408843 10.23116 16.55212 12.09375 17.8125 C 8.5266131 19.342333 6 22.881262 6 27 L 8 27 C 8 24.109626 9.5263067 21.592958 11.8125 20.1875 C 12.483006 21.834363 14.120749 23 16 23 C 17.879251 23 19.516994 21.834363 20.1875 20.1875 C 22.473693 21.592958 24 24.109626 24 27 L 26 27 C 26 22.881262 23.473387 19.342333 19.90625 17.8125 C 21.76884 16.55212 23 14.408843 23 12 C 23 8.1458513 19.854148 5 16 5 z M 16 7 C 18.773268 7 21 9.2267317 21 12 C 21 14.773268 18.773268 17 16 17 C 13.226732 17 11 14.773268 11 12 C 11 9.2267317 13.226732 7 16 7 z M 16 19 C 16.81989 19 17.600009 19.116459 18.34375 19.34375 C 17.997935 20.307297 17.090648 21 16 21 C 14.909352 21 14.002065 20.307297 13.65625 19.34375 C 14.399991 19.116459 15.18011 19 16 19 z"}),"","0 0 32 32");function qs({ticketIds:s,onSuccess:t,isCompact:a}){const{data:n}=xa(),i=ha(),[c,l]=d.useState(!1);return H("window","a",()=>l(!0)),e.jsxs(O,{isOpen:c,onOpenChange:l,onItemSelected:o=>i.mutate({ticketIds:s,userId:o},{onSuccess:t}),children:[e.jsx(ae,{isCompact:a,startIcon:e.jsx(pa,{}),endIcon:e.jsx(pe,{}),disabled:i.isPending,children:e.jsx(r,{message:"Assign (a)"})}),e.jsx($,{children:n==null?void 0:n.pagination.data.map(o=>e.jsx(j,{value:o.id,startIcon:e.jsx(Me,{user:o,size:"sm"}),children:o.display_name},o.id))})]})}function le(){return X({queryKey:["mailbox","sidenav-tags"],queryFn:()=>fa()})}function fa(){return b.get("tags/agent-mailbox").then(s=>s.data)}const ya=re(e.jsx("path",{d:"M 5 5 L 5 6 L 5 29 L 7 29 L 7 19 L 15 19 L 15 21 L 15 22 L 16 22 L 26 22 L 27 22 L 27 21 L 27 9 L 27 8 L 26 8 L 17 8 L 17 6 L 17 5 L 16 5 L 6 5 L 5 5 z M 7 7 L 15 7 L 15 8 L 15 9 L 15 17 L 7 17 L 7 7 z M 17 10 L 25 10 L 25 20 L 17 20 L 17 19 L 17 18 L 17 10 z"}),"","0 0 32 32");function Os({ticketIds:s,onSuccess:t,isCompact:a}){const{data:n}=le(),i=Lt(),[c,l]=d.useState(!1);return H("window","s",()=>l(!0)),e.jsxs(O,{isOpen:c,onOpenChange:l,onItemSelected:o=>i.mutate({ids:s,status:o},{onSuccess:()=>{t==null||t(),_(g("Status changed"))}}),children:[e.jsx(ae,{isCompact:a,startIcon:e.jsx(ya,{}),endIcon:e.jsx(pe,{}),disabled:i.isPending,children:e.jsx(r,{message:"Change status (s)"})}),e.jsx($,{children:n==null?void 0:n.statusTags.map(o=>e.jsx(j,{value:o.name,capitalizeFirst:!0,children:o.display_name||o.name},o.id))})]})}function ba(){return C({mutationFn:s=>va(s),onSuccess:async()=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),await k.invalidateQueries({queryKey:["tickets"]}),_(g("Tag added"))},onError:s=>N(s)})}function va(s){return b.post("tickets/tags/add",s).then(t=>t.data)}const ka=re(e.jsx("path",{d:"M 16 5 L 15.6875 5.28125 L 4.28125 16.8125 L 3.59375 17.5 L 4.28125 18.21875 L 13.78125 27.71875 L 14.5 28.40625 L 15.1875 27.71875 L 16.40625 26.5 C 17.46025 29.688126 20.466215 32 24 32 C 28.406433 32 32 28.406433 32 24 C 32 20.501976 29.731898 17.519896 26.59375 16.4375 L 26.71875 16.3125 L 27 16 L 27 15.59375 L 27 6 L 27 5 L 26 5 L 16.40625 5 L 16 5 z M 16.84375 7 L 25 7 L 25 15.15625 L 24.15625 16 C 24.103605 15.99897 24.052884 16 24 16 C 19.593567 16 16 19.593567 16 24 C 16 24.03173 15.999628 24.062105 16 24.09375 L 14.5 25.59375 L 6.40625 17.5 L 16.84375 7 z M 22 9 C 21.447715 9 21 9.4477153 21 10 C 21 10.552285 21.447715 11 22 11 C 22.552285 11 23 10.552285 23 10 C 23 9.4477153 22.552285 9 22 9 z M 24 18 C 27.325553 18 30 20.674447 30 24 C 30 27.325553 27.325553 30 24 30 C 20.674447 30 18 27.325553 18 24 C 18 20.674447 20.674447 18 24 18 z M 23 20 L 23 23 L 20 23 L 20 25 L 23 25 L 23 28 L 25 28 L 25 25 L 28 25 L 28 23 L 25 23 L 25 20 L 23 20 z"}),"","0 0 32 32");function $s({ticketIds:s,onSuccess:t,isCompact:a}){const n=ba(),[i,c]=d.useState(!1);return H("window","t",()=>c(!0)),e.jsxs(Y,{isOpen:i,onOpenChange:c,type:"popover",onClose:l=>{l&&n.mutate({tagName:l,ticketIds:s},{onSuccess:t})},children:[e.jsx(ae,{startIcon:e.jsx(ka,{}),isCompact:a,disabled:n.isPending,children:e.jsx(r,{message:"Add tag (t)"})}),e.jsx(Sa,{})]})}function Sa(){const{trans:s}=fe(),[t,a]=d.useState(""),[n,i]=d.useState(""),{data:c,isFetching:l}=Ft({query:t,perPage:8,notType:"status"}),{close:o,formId:u}=A();return e.jsxs(K,{size:"sm",children:[e.jsx(G,{children:e.jsx(r,{message:"Add tag"})}),e.jsx(Q,{children:e.jsx("form",{id:u,onSubmit:m=>{m.preventDefault(),o(n)},children:e.jsx(os,{isAsync:!0,isLoading:l,inputValue:t,onInputValueChange:a,selectedValue:n,onSelectionChange:m=>i(m),selectionMode:"single",placeholder:s(g("Enter tag name...")),allowCustomValue:!0,autoFocus:!0,children:c==null?void 0:c.pagination.data.map(m=>e.jsx(j,{value:m.name,textLabel:m.name,capitalizeFirst:!0,className:"rounded",children:m.display_name||m.name},m.id))})})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>o(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",form:u,children:e.jsx(r,{message:"Add"})})]})]})}function wa(){return C({mutationFn:s=>La(s),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets"]}),_(g("Tickets deleted"))},onError:s=>N(s)})}function La({ids:s}){return b.delete(`tickets/${s.join(",")}`).then(t=>t.data)}function Ta({ticketIds:s,onSuccess:t,isCompact:a}){const[n,i]=d.useState(!1);return H("window","d",()=>i(!0)),e.jsxs(Y,{type:"modal",isOpen:n,onOpenChange:i,children:[e.jsx(ae,{startIcon:e.jsx(Ts,{}),color:"danger",isCompact:a,children:e.jsx(r,{message:"Delete (d)"})}),e.jsx(Ca,{ticketIds:s,onDeleted:t})]})}function Ca({ticketIds:s,onDeleted:t}){const a=wa(),{close:n}=A();return e.jsx(ce,{isDanger:!0,isLoading:a.isPending,onConfirm:()=>{a.mutate({ids:s},{onSuccess:()=>{n(),t==null||t()}})},title:e.jsx(r,{message:"Delete tickets"}),body:e.jsx(r,{message:"Are you sure you want to delete selected tickets?"}),confirm:e.jsx(r,{message:"delete"})})}function We({ticketIds:s,onActionCompleted:t}){const a=d.useRef(null);return Gs({autoFocus:!0},a),e.jsxs(W.div,{ref:a,initial:{y:-30,opacity:1},animate:{y:0,opacity:1},exit:{y:30,opacity:0},tabIndex:-1,role:"menu",className:"fixed left-0 right-0 top-120 mx-auto flex w-max items-center justify-center gap-12 rounded border bg p-14 shadow-lg outline-none focus-visible:ring-2",children:[e.jsx(qs,{ticketIds:s,onSuccess:t}),e.jsx(Os,{ticketIds:s,onSuccess:t}),e.jsx($s,{ticketIds:s,onSuccess:t}),e.jsx(Ta,{ticketIds:s,onSuccess:t})]})}function Na(){const[s]=q(),t=s.get("orderBy")||"",a=s.get("orderDir")||"",n=d.useMemo(()=>({orderBy:t,orderDir:a}),[t,a]),i=qe({...te(),loader:"ticketTable"}),{data:c,isLoading:l,isPlaceholderData:o}=i,u=(c==null?void 0:c.pagination.data)||[],m=!l&&!o&&u.length===0,v=Es(),[p,S]=d.useState([]);return e.jsxs(d.Fragment,{children:[e.jsx(Ke,{query:i}),e.jsxs("div",{className:"flex min-h-full min-w-0 flex-col",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(Ve,{query:i,selectedTickets:p,onSelectionChange:S,sortDescriptor:n,onSortChange:f=>{v({orderBy:f.orderBy,orderDir:f.orderDir})}}),m&&e.jsx(Pe,{className:"mt-40",size:"sm",image:e.jsx(ds,{src:na}),title:e.jsx(r,{message:"There are no tickets in this category yet."})})]}),e.jsx(ra,{query:i,onPageChange:f=>v({page:f}),onPerPageChange:f=>v({perPage:f})}),e.jsx(ee,{children:p.length&&e.jsx(We,{ticketIds:p,onActionCompleted:()=>S([])})})]})]})}function Ge({element:s,onOpenSearchPage:t}){const a=F(),n=d.useCallback(()=>{a("/agent/search")},[a]),i=s;return e.jsx(i,{menuPosition:"agent-mailbox",color:"bg",size:"md",children:e.jsx(Wt,{size:"sm",width:"w-320",onTrigger:t||n,children:e.jsx(r,{message:"Search"})})})}function Ia(){const s=F();return e.jsxs("aside",{className:"compact-scrollbar flex w-full flex-col gap-24 overflow-y-auto border-r text-muted",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(as,{icon:e.jsx(Xt,{}),children:e.jsx(r,{message:"Inbox"})}),e.jsx(ns,{type:"viewTags"}),e.jsx(as,{icon:e.jsx(Yt,{}),children:e.jsx(r,{message:"Folders"})}),e.jsx(ns,{type:"categoryTags"})]}),e.jsx("div",{className:"mt-auto p-14",children:e.jsxs(O,{placement:"top",children:[e.jsx(h,{className:"min-h-34 w-full",variant:"outline",startIcon:e.jsx(us,{}),endIcon:e.jsx(Zt,{}),size:"xs",children:e.jsx(r,{message:"Settings"})}),e.jsxs($,{children:[e.jsx(j,{value:"saved-replies",onSelected:()=>s("/agent/saved-replies"),children:e.jsx(r,{message:"Saved replies"})}),e.jsx(j,{value:"new-ticket",onSelected:()=>s("/agent/tickets/new"),children:e.jsx(r,{message:"New ticket"})}),e.jsx(j,{value:"notifications",onSelected:()=>s("/notifications/settings"),children:e.jsx(r,{message:"Notifications"})})]})]})})]})}function as({icon:s,children:t}){return e.jsxs("div",{className:"mb-14 flex items-center gap-8 px-14 pt-20",children:[s,e.jsx("div",{className:"text-sm font-semibold uppercase",children:t})]})}const Bs="flex h-40 items-center justify-between gap-8 pl-38 pr-8 mx-8 rounded-lg";function ns({type:s}){const{data:t,isLoading:a}=le(),n=t==null?void 0:t[s],i=e.jsx(W.div,{...J,children:[...Array(4)].map((c,l)=>e.jsx("div",{className:w(Bs,"max-w-172 border-l-transparent"),children:e.jsx(Fe,{variant:"text"})},l))},"skeletons");return e.jsx(ee,{initial:!1,mode:"wait",children:a?i:e.jsx(W.ul,{className:"cursor-pointer text-sm",...J,children:n==null?void 0:n.map(c=>e.jsx(Da,{tag:c},c.id))},"tag-list")})}function Da({tag:s}){const t=`${s.id}`===te().tagId;return e.jsx("li",{children:e.jsxs(Js,{className:w(Bs,t?"border-l-primary bg-primary/6 hover:bg-primary/10":"border-l-transparent hover:bg-hover"),to:`/agent/tickets?tagId=${s.id}`,end:!0,children:[" ",e.jsxs(d.Fragment,{children:[e.jsx(r,{message:s.display_name||s.name}),s.tickets_count?e.jsx("div",{className:w("flex h-18 w-30 items-center justify-center rounded-full text-[11px] font-semibold",t&&"bg-primary text-on-primary"),children:s.tickets_count}):null]})]})},s.id)}function Ce({children:s,rightSidenav:t}){return e.jsxs(_s,{name:"mailbox",children:[e.jsx(Ge,{element:As}),e.jsx(He,{position:"left",className:"bg-alt",children:e.jsx(Ia,{})}),e.jsx(Ps,{children:e.jsx("main",{children:s})}),t]})}function _a(){return e.jsx(Ce,{children:e.jsx(Na,{})})}function Aa(s,t,a){var n=this,i=d.useRef(null),c=d.useRef(0),l=d.useRef(null),o=d.useRef([]),u=d.useRef(),m=d.useRef(),v=d.useRef(s),p=d.useRef(!0);d.useEffect(function(){v.current=s},[s]);var S=!t&&t!==0&&typeof window<"u";if(typeof s!="function")throw new TypeError("Expected a function");t=+t||0;var f=!!(a=a||{}).leading,U=!("trailing"in a)||!!a.trailing,I="maxWait"in a,x=I?Math.max(+a.maxWait||0,t):null;d.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var ne=d.useMemo(function(){var Ne=function(L){var T=o.current,ue=u.current;return o.current=u.current=null,c.current=L,m.current=v.current.apply(ue,T)},oe=function(L,T){S&&cancelAnimationFrame(l.current),l.current=S?requestAnimationFrame(L):setTimeout(L,T)},Ze=function(L){if(!p.current)return!1;var T=L-i.current;return!i.current||T>=t||T<0||I&&L-c.current>=x},es=function(L){return l.current=null,U&&o.current?Ne(L):(o.current=u.current=null,m.current)},Ie=function L(){var T=Date.now();if(Ze(T))return es(T);if(p.current){var ue=t-(T-i.current),Vs=I?Math.min(ue,x-(T-c.current)):ue;oe(L,Vs)}},de=function(){var L=Date.now(),T=Ze(L);if(o.current=[].slice.call(arguments),u.current=n,i.current=L,T){if(!l.current&&p.current)return c.current=i.current,oe(Ie,t),f?Ne(i.current):m.current;if(I)return oe(Ie,t),Ne(i.current)}return l.current||oe(Ie,t),m.current};return de.cancel=function(){l.current&&(S?cancelAnimationFrame(l.current):clearTimeout(l.current)),c.current=0,o.current=i.current=u.current=l.current=null},de.isPending=function(){return!!l.current},de.flush=function(){return l.current?es(Date.now()):m.current},de},[f,I,t,x,U,S]);return ne}function Pa(){const{data:s}=le();return d.useMemo(()=>s?[{key:"status",label:g("Status"),description:g("Ticket status"),defaultOperator:me.eq,control:{type:xe.Select,defaultValue:"01",options:s.statusTags.map(t=>({key:t.id,label:g(t.display_name||t.name),value:t.name}))}},{key:"tag",label:g("Folder"),description:g("Folder ticket is assigned to"),defaultOperator:me.eq,control:{type:xe.Select,defaultValue:"01",options:s.categoryTags.map(t=>({key:t.id,label:g(t.display_name||t.name),value:t.name}))}},zt({description:g("Date ticket was created")}),Rt({description:g("Date ticket was last updated")}),Et({key:"closed_at",label:g("Closed at"),description:g("Date ticket was closed")}),{key:"user_id",label:g("Customer"),description:g("Customer that created the ticket"),defaultOperator:me.eq,control:{type:xe.SelectModel,model:ts}},{key:"assigned_to",label:g("Assignee"),description:g("Agent assigned to the ticket"),defaultOperator:me.eq,control:{type:xe.SelectModel,model:ts}}]:null,[s])}function Fa(s=!1){d.useEffect(()=>(s?document.documentElement.classList.remove("stable-scrollbar"):document.documentElement.classList.add("stable-scrollbar"),()=>{document.documentElement.classList.remove("stable-scrollbar")}),[s])}const is=[{uri:"tickets",label:g("Tickets"),key:0},{uri:"users",label:g("Users"),key:1},{uri:"articles",label:g("Articles"),key:2}];function za(){var I;const[s,t]=q(),a=s.get("query")||"",{pathname:n}=ms(),i=n.split("/").pop(),c=((I=is.find(x=>x.uri===i))==null?void 0:I.key)??0,l=d.useRef(null),[o,u]=d.useState(a);Fa(),d.useEffect(()=>{u(a)},[a]);const m=x=>{t(ne=>(ne.delete("page"),ne.set("query",x),ne))},v=Aa(x=>{m(x)},400),p=x=>{u(x),v(x)},S=d.useCallback(()=>{var x;(x=l.current)==null||x.focus()},[]),f=Pa(),U=f&&c===0;return e.jsxs("div",{children:[e.jsx(Ge,{element:Xs,onOpenSearchPage:S}),e.jsxs("main",{className:"container mx-auto p-14 md:p-24",children:[e.jsxs("div",{className:"mb-34 flex items-center gap-24 pt-6",children:[e.jsx("form",{className:"flex-auto",onSubmit:x=>{x.preventDefault(),m(o)},children:e.jsx(Ys,{onBlur:()=>m(o),inputRef:l,value:o,onChange:x=>{p(x.target.value)},startAdornment:e.jsx(xs,{}),autoFocus:!0})}),U&&e.jsx(Mt,{className:"min-h-42 min-w-42",filters:f})]}),U&&e.jsx(qt,{filters:f}),e.jsxs(Cs,{selectedTab:c,children:[e.jsx(Ns,{children:is.map(x=>e.jsx(Ae,{width:"min-w-132",elementType:P,to:`/agent/search/${x.uri}?query=${o}`,relative:"path",replace:!0,children:e.jsx(r,{...x.label})},x.key))}),e.jsx("div",{className:"pt-34",children:e.jsx(gs,{})})]})]})]})}function Ra(){const[s]=q(),t={filters:s.get("filters")??"",query:s.get("query")??"",page:s.get("page")??"1",perPage:s.get("perPage")??"20"},a=!!t.query||!!t.filters;return X({queryKey:["tickets","search",t],queryFn:()=>Ea(t),placeholderData:a?ze:void 0,enabled:a})}function Ea(s){return b.get("search/tickets",{params:s}).then(t=>t.data)}function Je({query:s,children:t}){const[a,n]=q(),{data:i,fetchStatus:c,isLoading:l,isPlaceholderData:o}=s,u=(i==null?void 0:i.pagination.data)||[],m=c==="idle"&&u.length===0||!l&&!o&&u.length===0;return e.jsxs(d.Fragment,{children:[e.jsx(Ke,{query:s}),t,m&&e.jsx(At,{isFiltering:!!a.get("query")||!!a.get("filters"),className:"mt-48",image:Fs,title:e.jsx(r,{message:"Enter your query or filters to start searching"}),filteringTitle:e.jsx(r,{message:"No results match your query or filters"})}),e.jsx($e,{query:s,onPageChange:v=>n(p=>(p.set("page",v.toString()),p)),onPerPageChange:v=>n(p=>(p.set("perPage",v.toString()),p))})]})}function rs(){const s=Ra(),[t,a]=d.useState([]);return e.jsxs(Je,{query:s,children:[e.jsx(Ve,{query:s,selectedTickets:t,onSelectionChange:a}),e.jsx(ee,{children:t.length&&e.jsx(We,{ticketIds:t,onActionCompleted:()=>a([])})})]})}function Ma(){const[s]=q(),t={query:s.get("query")??"",page:s.get("page")??"1",perPage:s.get("perPage")??"20"};return X({queryKey:["users","search",t],queryFn:()=>qa(t),placeholderData:ze,enabled:!!t.query})}function qa(s){return b.get("search/users",{params:s}).then(t=>t.data)}const Oa=[{key:"name",allowsSorting:!0,sortingKey:"email",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(r,{message:"User"}),body:s=>e.jsx(Ot,{image:s.avatar,label:s.display_name,description:s.email})},{key:"roles",header:()=>e.jsx(r,{message:"Roles"}),body:s=>{var t;return e.jsx(Be,{radius:"rounded",size:"xs",children:(t=s.roles)==null?void 0:t.map(a=>e.jsx(je,{selectable:!0,className:"capitalize",children:e.jsx(r,{message:a.name})},a.id))})}},{key:"createdAt",allowsSorting:!0,width:"w-96",header:()=>e.jsx(r,{message:"Created at"}),body:s=>e.jsx("time",{children:e.jsx(z,{date:s.created_at})})}];function $a(){var a;const s=F(),t=Ma();return e.jsx(Je,{query:t,children:e.jsx(Ue,{headerCellHeight:"h-36",cellHeight:"h-64",columns:Oa,data:((a=t.data)==null?void 0:a.pagination.data)||[],enableSelection:!1,onAction:n=>s(`/agent/users/${n.id}`)})})}const Ba=[{key:"name",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(r,{message:"Article"}),body:s=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(Zs,{}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:s.title}),e.jsx(ps,{article:s,className:"text-xs text-muted"})]})]})},{key:"updated_at",allowsSorting:!0,width:"w-96",header:()=>e.jsx(r,{message:"Last updated"}),body:s=>e.jsx("time",{children:e.jsx(z,{date:s.updated_at})})}];function Ua(){var n;const s=F(),[t]=q(),a=hs(t.get("query")||"",{page:t.get("page")??"1",perPage:t.get("perPage")??"20",paginate:"lengthAware"},{disableDebounce:!0});return e.jsx(Je,{query:a,children:e.jsx(Ue,{headerCellHeight:"h-36",cellHeight:"h-64",columns:Ba,data:((n=a.data)==null?void 0:n.pagination.data)||[],enableSelection:!1,onAction:i=>s(js(i))})})}const Ka=re(e.jsx("path",{d:"M 5 5 L 5 6 L 5 26 L 5 27 L 6 27 L 20 27 L 20.40625 27 L 20.71875 26.71875 L 26.71875 20.71875 L 27 20.40625 L 27 20 L 27 6 L 27 5 L 26 5 L 6 5 L 5 5 z M 7 7 L 25 7 L 25 19 L 20 19 L 19 19 L 19 20 L 19 25 L 7 25 L 7 7 z M 21 21 L 23.5625 21 L 21 23.5625 L 21 21 z"}),"","0 0 32 32"),Qa=re(e.jsx("path",{d:"M 8.28125 5.28125 L 2.28125 11.28125 L 1.59375 12 L 2.28125 12.71875 L 8.28125 18.71875 L 9.71875 17.28125 L 5.4375 13 L 23 13 C 25.754545 13 28 15.245455 28 18 C 28 20.754545 25.754545 23 23 23 L 20 23 L 20 25 L 23 25 C 26.845455 25 30 21.845455 30 18 C 30 14.154545 26.845455 11 23 11 L 5.4375 11 L 9.71875 6.71875 L 8.28125 5.28125 z M 8 23 L 8 25 L 10 25 L 10 23 L 8 23 z M 12 23 L 12 25 L 14 25 L 14 23 L 12 23 z M 16 23 L 16 25 L 18 25 L 18 23 L 16 23 z"}),"","0 0 32 32"),Ha={stay_on_page:g("Send and stay on page"),next_active_ticket:g("Send and next ticket"),back_to_folder:g("Send and back to folder")};function Xe(){const{tagId:s}=te(),{ticketId:t}=B(),a=Es(),{replies:n}=se(),i=F(),c=(n==null?void 0:n.after_reply_action)||"next_active_ticket",[l,o]=Re("after_reply_action",c),u=d.useCallback(async()=>{if(l==="next_active_ticket"){const m=await b.get(`tickets/${s}/next-active-ticket`);m!=null&&m.data.ticket&&(t===`${m.data.ticket.id}`?a():i(Te(m.data.ticket,{tagId:s})))}else l==="back_to_folder"&&a()},[l,a,s,i]);return{action:l,setAction:o,perform:u}}function Va(){const{ticketId:s}=B();return C({mutationFn:t=>Wa(s,t),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets",`${s}`]}),_(g("Note added"))},onError:t=>N(t)})}function Wa(s,t){return b.post(`tickets/${s}/notes`,t).then(a=>a.data)}function Ga(){const s=d.useRef(null),{close:t}=A(),a=Va(),[n,i]=d.useState([]),c=()=>{a.mutate({body:Le(s),attachments:n.map(l=>l.id)},{onSuccess:()=>t()})};return e.jsxs(K,{size:"lg",children:[e.jsx(G,{children:e.jsx(r,{message:"Add a note"})}),e.jsx(Q,{children:e.jsx(ye,{children:e.jsx(we,{minHeight:"min-h-[300px]",isLoading:a.isPending,editorRef:s,className:"mb-24",attachments:n,onAttachmentsChange:l=>i(l),onSubmit:()=>c()})})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>t(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",onClick:()=>c(),disabled:a.isPending,children:e.jsx(r,{message:"Add"})})]})]})}function Ja({ticket:s}){const t=ia(),{perform:a}=Xe();return e.jsxs("div",{className:"flex items-center gap-14 border-b py-4 pl-14 pr-20",children:[e.jsx(ae,{startIcon:e.jsx(Qa,{}),isCompact:!0,elementType:P,to:t,children:e.jsx(r,{message:"Back (b)"})}),e.jsx(qs,{ticketIds:[s.id],isCompact:!0}),e.jsx(Xa,{}),e.jsx($s,{ticketIds:[s.id],isCompact:!0}),e.jsx(Os,{ticketIds:[s.id],isCompact:!0,onSuccess:()=>a()}),e.jsxs("div",{className:"ml-auto text-2xl",children:["#",s.id]}),s.status&&e.jsx(je,{size:"sm",radius:"rounded",className:"font-bold capitalize",color:s.status==="open"?"primary":"chip",children:e.jsx(r,{message:s.status})})]})}function Xa(){const[s,t]=d.useState(!1);return H("window","n",()=>t(!0)),e.jsxs(Y,{type:"modal",isOpen:s,onOpenChange:t,children:[e.jsx(ae,{startIcon:e.jsx(Ka,{}),isCompact:!0,children:e.jsx(r,{message:"Note (n)"})}),e.jsx(Ga,{})]})}function Ya(){return C({mutationFn:s=>Za(s),onSuccess:async(s,t)=>{await k.invalidateQueries({queryKey:["tickets",`${t.reply.ticket_id}`]})},onError:s=>N(s)})}function Za(s){return b.delete(`replies/${s.reply.id}`).then(t=>t.data)}function Us(){return C({mutationFn:s=>en(s),onSuccess:async(s,t)=>{await k.invalidateQueries({queryKey:["tickets",`${t.reply.ticket_id}`,"replies"]})},onError:s=>N(s)})}function en({reply:s,...t}){return b.put(`replies/${s.id}`,t).then(a=>a.data)}function sn({reply:s}){var t;return(t=s.attachments)!=null&&t.length?e.jsx(ws,{className:"mt-30 w-max",children:s.attachments.map((a,n)=>e.jsx(Ls,{attachments:s.attachments,index:n,onRemove:()=>{R(tn,{reply:s,attachment:a})}},a.id))}):null}function tn({reply:s,attachment:t}){const a=Us(),{close:n}=A();return e.jsx(ce,{isDanger:!0,title:e.jsx(r,{message:"Delete attachment"}),body:e.jsx(r,{message:"Are you sure you want to delete this attachment?"}),confirm:e.jsx(r,{message:"Delete"}),onConfirm:()=>{a.mutate({reply:s,attachments:s.attachments.filter(i=>i.id!==t.id).map(i=>i.id)},{onSuccess:n})},isLoading:a.isPending})}function an({reply:s}){const t=d.useRef(null),{close:a}=A(),n=Us(),[i,c]=d.useState(s.attachments||[]),l=s.type==="notes"?e.jsx(r,{message:"Edit note"}):e.jsx(r,{message:"Edit reply"}),o=()=>{n.mutate({reply:s,body:Le(t),attachments:i.map(u=>u.id)},{onSuccess:()=>{a(),_(s.type==="notes"?g("Updated note"):g("Updated reply"))}})};return e.jsxs(K,{size:"lg",children:[e.jsx(G,{children:l}),e.jsx(Q,{children:e.jsx(ye,{children:e.jsx(we,{minHeight:"min-h-[300px]",isLoading:n.isPending,initialContent:s.body,editorRef:t,attachments:i,onAttachmentsChange:u=>c(u),onSubmit:()=>o()})})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>a(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",onClick:()=>o(),disabled:n.isPending,children:e.jsx(r,{message:"Save"})})]})]})}function nn(s){return X({queryKey:["original-email",`${s}`],queryFn:()=>rn(s),staleTime:1/0})}function rn(s){return b.get(`replies/${s}/original`).then(t=>t.data)}function cn({replyId:s}){var c;const{base_url:t}=se(),a=nn(s),[n,i]=d.useState("html");return e.jsxs(K,{size:"fullscreen",className:"h-dialog",children:[e.jsx(G,{showDivider:!0,padding:"px-24 py-12",titleFontWeight:"font-normal",titleTextSize:"text-base",justify:"justify-start",actions:e.jsxs("div",{children:[e.jsxs($t,{variant:"outline",radius:"rounded-md",size:"xs",value:n,onChange:i,children:[e.jsx(h,{value:"html",children:e.jsx(r,{message:"HTML"})}),e.jsx(h,{value:"plain",children:e.jsx(r,{message:"Plain"})}),e.jsx(h,{value:"headers",children:e.jsx(r,{message:"Headers"})})]}),e.jsx(h,{className:"ml-34",variant:"outline",size:"xs",elementType:"a",download:!0,href:`${t}/api/v1/replies/${s}/original/download`,children:e.jsx(r,{message:"Download"})})]}),children:e.jsx(r,{message:"Original email"})}),e.jsx(Q,{children:(c=a.data)!=null&&c.email?e.jsx(ln,{data:a.data,activeTab:n}):e.jsx(on,{query:a})})]})}function ln({data:s,activeTab:t}){return t==="html"?e.jsx("div",{dangerouslySetInnerHTML:{__html:s.email.body.html}}):t==="plain"?e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:s.email.body.plain}):e.jsx("table",{children:e.jsx("tbody",{children:Object.entries(s.email.headers).map(([a,n])=>e.jsxs("tr",{children:[e.jsx("th",{className:"whitespace-nowrap border px-20 py-10 text-left",children:a}),e.jsx("td",{className:"whitespace-nowrap border px-20 py-10 text-left",children:n})]},a))})})}function on({query:s}){return s.isLoading?e.jsx(et,{className:"absolute inset-0 m-auto"}):e.jsx(Pe,{className:"mt-40",image:e.jsx("div",{children:e.jsx(st,{size:"xl"})}),imageHeight:"h-auto",title:e.jsx(r,{message:"Original email for this reply does not exist"})})}function dn({data:{ticket:s,replies:t,draft:a}}){const n=E(l=>l.editorIsOpen),i=a&&!n,c=bs(s.id,t);return e.jsxs("div",{children:[i&&e.jsx(De,{reply:a,className:"pl-20 pr-8",actions:e.jsx(cs,{reply:a})}),c.items.map(l=>{var u;const o=!c.hasNextPage&&l.id===((u=c.items.at(-1))==null?void 0:u.id);return e.jsx(De,{className:"pl-20 pr-8",reply:l,isInitial:o,actions:e.jsx(cs,{reply:l}),attachments:e.jsx(sn,{reply:l})},l.id)}),e.jsx(Oe,{query:c})]})}function cs({reply:s}){return e.jsxs(O,{children:[e.jsx(D,{className:"text-muted",size:"sm",children:e.jsx(Bt,{})}),e.jsxs($,{children:[e.jsx(j,{value:"edit",onClick:()=>R(an,{reply:s}),children:e.jsx(r,{message:"Edit"})}),s.type==="replies"&&e.jsx(j,{value:"showOriginal",onClick:()=>R(cn,{replyId:s.id}),children:e.jsx(r,{message:"Show original"})}),e.jsx(j,{value:"delete",onClick:()=>R(un,{reply:s}),children:e.jsx(r,{message:"Delete"})})]})]})}function un({reply:s}){const t=Ya();let a=e.jsx(r,{message:"Delete reply"}),n=e.jsx(r,{message:"Are you sure you want to delete this reply?"});return s.type==="notes"&&(a=e.jsx(r,{message:"Delete note"}),n=e.jsx(r,{message:"Are you sure you want to delete this note?"})),e.jsx(ce,{isDanger:!0,title:a,body:n,confirm:e.jsx(r,{message:"Delete"}),onConfirm:()=>t.mutate({reply:s},{onSuccess:()=>tt()}),isLoading:t.isPending})}function mn(){return C({mutationFn:s=>xn(s),onSuccess:(s,t)=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),t.ticketIds.forEach(a=>{at(a,n=>{var i;n.ticket.tags=(i=n.ticket.tags)==null?void 0:i.filter(c=>c.id!==t.tagId)})})},onError:s=>N(s)})}function xn(s){return b.post("tickets/tags/remove",s).then(t=>t.data)}function gn({data:{ticket:s}}){const t=mn(),a=E(c=>c.editorIsOpen),n=Tt(),i=c=>{t.mutate({ticketIds:[s.id],tagId:c.id})};return H("window","r",()=>{a||n()}),e.jsx(vs,{ticket:s,actions:s.status!=="locked"&&e.jsx(h,{variant:"outline",size:"xs",onClick:()=>n(),startIcon:e.jsx(ta,{}),disabled:a,children:e.jsx(r,{message:"Reply"})}),children:e.jsx(ks,{ticket:s,onRemoveTag:i})})}function Ye({label:s,children:t,name:a,className:n}){const[i,c]=Re(a,!0);return e.jsxs("section",{className:w("border-b pb-14 text-sm",n),children:[e.jsxs("div",{className:"flex items-center justify-between gap-14 px-14",children:[e.jsx("div",{className:"font-semibold",children:s}),e.jsx(D,{onClick:()=>c(!i),className:w("transition-transform",i&&"rotate-180"),children:e.jsx(pe,{})})]}),i&&e.jsx("div",{className:"pt-8",children:t})]})}function hn({purchaseCode:s}){const{close:t}=A(),a=nt();return e.jsxs(K,{size:"md",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex items-start gap-14 text-sm",children:[e.jsx("img",{src:s.image,alt:"",className:"h-80 w-80 flex-shrink-0 rounded"}),e.jsxs("div",{className:"flex-auto",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:it,children:s.item_name}),e.jsx("div",{className:"mt-4 text-sm text-muted",children:s.code}),e.jsxs("div",{className:"mt-12",children:[e.jsx(ge,{label:e.jsx(r,{message:"Customer"}),value:s.envato_username}),e.jsx(ge,{label:e.jsx(r,{message:"Purchased"}),value:e.jsx(z,{date:s.purchased_at})}),e.jsx(ge,{label:e.jsx(r,{message:"Supported until"}),value:e.jsx(z,{date:s.supported_until})}),e.jsx(ge,{label:e.jsx(r,{message:"Last synced"}),value:e.jsx(z,{date:s.updated_at})})]})]})]})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>t(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{variant:"flat",color:"primary",disabled:a.isPending,onClick:()=>a.mutate({userId:s.user_id}),children:e.jsx(r,{message:"Sync purchases"})})]})]})}function ge({label:s,value:t}){return e.jsxs("div",{className:"mb-6 flex items-center gap-14",children:[e.jsxs("div",{children:[s,":"]}),e.jsx("div",{className:"text-muted",children:t})]})}function Ks({purchases:s,itemClassName:t,activePurchase:a}){return e.jsx("div",{children:s.map(n=>e.jsxs(Y,{type:"modal",children:[e.jsxs("div",{className:w("flex cursor-pointer items-center gap-8 rounded py-8 hover:bg-hover",t,(a==null?void 0:a.code)===n.code&&"bg-primary-light/30"),children:[e.jsx("img",{src:n.image,alt:"",className:"h-30 w-30 rounded"}),e.jsxs("div",{className:"min-w-0 text-xs",children:[e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:n.item_name}),e.jsx("div",{className:w("text-muted",n.support_expired&&"line-through"),children:n.supported_until?e.jsx(z,{date:n.supported_until}):n.support_expired?e.jsx(r,{message:"Support expired"}):"-"})]})]}),e.jsx(hn,{purchaseCode:n})]},n.id))})}function jn({user:s,ticket:t}){const a=d.useMemo(()=>{var c,l,o,u;const n=(l=(c=t.tags)==null?void 0:c.find(m=>m.type!=="status"))==null?void 0:l.categories[0];let i;if(n){const m=n.name.toLowerCase();i=(o=s.purchase_codes)==null?void 0:o.find(v=>v.item_name.toLowerCase().indexOf(m)>-1)}return i||((u=s.purchase_codes)==null?void 0:u[0])},[s,t]);return e.jsx(Ye,{label:e.jsx(r,{message:"Envato"}),name:"purchase-list-visible",children:e.jsxs("div",{className:"overflow-hidden",children:[a&&e.jsxs("div",{className:"mb-8 flex items-center gap-4 px-14 text-sm",children:[e.jsx(rt,{size:"sm"}),e.jsx("a",{href:`https://codecanyon.net/user/${a.envato_username}`,target:"_blank",rel:"noreferrer",children:a.envato_username})]}),e.jsx(Ks,{purchases:s.purchase_codes||[],itemClassName:"px-14",activePurchase:a})]})})}function pn(s){return Ct({queryKey:["activity-log"],endpoint:"activity-log",paginate:"simple",queryParams:s})}const fn="article",yn="search_term";function bn({children:s,className:t}){const a=d.Children.toArray(s);return e.jsx("div",{className:t,children:a.map((n,i)=>d.cloneElement(n,{isLast:i===a.length-1}))})}function vn({children:s,className:t,isLast:a}){return e.jsxs("div",{className:w("flex gap-12",t),children:[e.jsxs("div",{children:[e.jsx("div",{className:"mt-4 h-12 w-12 flex-shrink-0 rounded-full border-[3px]"}),!a&&e.jsx("div",{className:"mx-auto mt-4 h-[calc(100%-12px)] w-1 bg-chip"})]}),e.jsx("div",{className:"flex-auto",children:s})]})}const kn={hour:"numeric",minute:"numeric"};function Sn({ticket:s}){const t=s.user.id,a=pn({userId:t}),n=e.jsx(W.div,{className:"px-14 py-6",...J,children:Array.from({length:5}).map((c,l)=>e.jsx(Fe,{className:"min-h-48"},l))},"skeletons"),i=e.jsxs(d.Fragment,{children:[e.jsx(W.div,{...J,children:e.jsx(bn,{children:a.items.map(c=>{var l;return e.jsxs(vn,{className:w("px-14 py-6",c.event==="created"&&((l=c.subject)==null?void 0:l.id)===s.id&&"bg-primary/8"),children:[e.jsx(wn,{activity:c}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted",children:[e.jsx(ls,{date:c.created_at}),e.jsx("div",{children:"•"}),e.jsx(z,{date:c.created_at,options:kn})]})]},c.id)})})},"timeline"),e.jsx(Oe,{query:a,size:"sm"})]});return e.jsx(Ye,{label:e.jsx(r,{message:"Activity"}),name:"activity-visible",className:"mt-10",children:e.jsx(ee,{initial:!1,mode:"wait",children:a.isLoading?n:i})})}function wn({activity:s}){var t;switch((t=s.subject)==null?void 0:t.model_type){case fn:return e.jsx(r,{message:"Viewd article: :link",values:{link:e.jsx(ct,{target:"_blank",className:"font-semibold",article:s.subject})}});case ma:return e.jsx(Ln,{activity:s});case yn:const a=s.subject.term;return e.jsx(r,{message:"Search for: :link",values:{link:e.jsx(P,{target:"_blank",className:"font-semibold",to:`/hc/search?query=${a}`,children:a})}});default:return null}}function Ln({activity:s}){var a,n,i,c;const t=e.jsx(oa,{target:"_blank",className:"font-semibold",ticket:s.subject});return s.event==="replied"?((a=s.properties)==null?void 0:a.source)==="email"?e.jsx(r,{message:"Replied via email: :link",values:{link:t}}):e.jsx(r,{message:"Replied via website: :link",values:{link:t}}):s.event==="created"?e.jsx(r,{message:"Created ticket: :link",values:{link:t}}):s.event==="articlesSuggested"?e.jsx(r,{message:'Suggested :count articles for ":query"',values:{count:((i=(n=s.properties)==null?void 0:n.articleIds)==null?void 0:i.length)||1,query:(c=s.properties)==null?void 0:c.query}}):null}function Tn(){const{ticketId:s}=B();return C({mutationFn:t=>Cn({...t,ticketId:s}),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets"]}),_(g("Merged tickets"))},onError:t=>N(t)})}function Cn(s){return b.post("tickets/merge",s).then(t=>t.data)}function Nn({ticketId:s}){var a,n;const t=Ee(s);return e.jsxs(K,{size:"fullscreen",className:"h-dialog",children:[e.jsx(G,{showDivider:!0,padding:"px-24 py-12",titleFontWeight:"font-normal",titleTextSize:"text-base",justify:"justify-start",actions:(a=t.data)!=null&&a.ticket?e.jsx(In,{ticket:(n=t.data)==null?void 0:n.ticket}):null,children:e.jsx(r,{message:"Ticket preview"})}),e.jsx(Q,{className:"bg",padding:"p-0",children:t.data?e.jsx(_n,{data:t.data}):e.jsx(be,{query:t,loaderClassName:"absolute inset-0 m-auto"})})]})}function In({ticket:s}){const{close:t}=A();return e.jsxs(d.Fragment,{children:[e.jsx(h,{elementType:P,to:Te(s),variant:"outline",size:"xs",children:e.jsx(r,{message:"Open ticket"})}),e.jsxs(Y,{type:"modal",onClose:a=>{a&&t()},children:[e.jsx(h,{variant:"outline",size:"xs",className:"mr-48",children:e.jsx(r,{message:"Merge"})}),e.jsx(Dn,{ticket:s})]})]})}function Dn({ticket:s}){const t=Tn(),{close:a}=A();return e.jsx(ce,{title:e.jsx(r,{message:"Merge tickets"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({mergeeId:s.id},{onSuccess:n=>a(n.ticket)})},body:e.jsxs("div",{children:[e.jsx(r,{message:"Please confirm you'd like to merge this ticket with the original one behind the popup."}),e.jsx("p",{className:"mt-12 font-semibold",children:e.jsx(r,{message:"Merged tickets cannot be unmerged."})})]}),confirm:e.jsx(r,{message:"Merge"})})}function _n({data:s}){return e.jsxs("div",{children:[e.jsx(vs,{ticket:s.ticket,children:e.jsx(ks,{ticket:s.ticket})}),e.jsx(An,{data:s})]})}function An({data:{ticket:s,replies:t}}){const a=bs(s.id,t);return e.jsxs(d.Fragment,{children:[a.items.map(n=>{var c,l;const i=!a.hasNextPage&&n.id===((c=a.items.at(-1))==null?void 0:c.id);return e.jsx(De,{reply:n,isInitial:i,className:"px-20",attachments:(l=n.attachments)!=null&&l.length?e.jsx(Pn,{attachments:n.attachments}):null},n.id)}),e.jsx(Oe,{query:a})]})}function Pn({attachments:s}){return e.jsx(ws,{className:"mt-30 w-max",children:s.map((t,a)=>e.jsx(Ls,{attachments:s,index:a},t.id))})}function Fn({ticketId:s}){const{close:t,formId:a}=A(),n=ve(),i=Nt(s,n);return e.jsxs(K,{children:[e.jsx(G,{children:e.jsx(r,{message:"Change customer"})}),e.jsx(Q,{children:e.jsx(ke,{id:a,form:n,onSubmit:c=>{i.mutate(c,{onSuccess:()=>t()})},children:e.jsx(Qe,{required:!0,name:"user_id",endpoint:"normalized-models/user",label:e.jsx(r,{message:"New customer"})})})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>t(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{type:"submit",form:a,variant:"flat",color:"primary",disabled:i.isPending,children:e.jsx(r,{message:"Change"})})]})]})}function zn({className:s}){const{tickets:t}=se(),{data:a}=Ee();return e.jsx("div",{className:w(s,"compact-scrollbar stable-scrollbar overflow-y-auto border-l"),children:(a==null?void 0:a.ticket.user)&&e.jsxs(d.Fragment,{children:[e.jsx(Rn,{ticket:a.ticket}),e.jsx(En,{ticket:a.ticket}),(t==null?void 0:t.log_activity)&&e.jsx(Sn,{ticket:a.ticket})]})})}function Rn({ticket:s}){var i,c;const t=s.user,{envato:a}=se(),n=_e(t.id);return e.jsxs("div",{className:"py-14",children:[e.jsx(P,{to:n,target:"_blank",children:e.jsx(Me,{user:t,size:"xl",circle:!0,className:"mx-auto"})}),e.jsxs("section",{className:"mb-14 border-b px-14 pb-14 text-muted",children:[e.jsxs("div",{className:"mt-10 flex items-center justify-between gap-14 text-muted",children:[e.jsx("div",{children:t.display_name}),e.jsxs(O,{children:[e.jsx(D,{size:"sm",children:e.jsx(us,{})}),e.jsxs($,{children:[e.jsx(j,{value:"edit",elementType:P,to:n,target:"_blank",children:e.jsx(r,{message:"Edit"})}),e.jsx(j,{value:"changeCustomer",onSelected:()=>R(Fn,{ticketId:s.id}),children:e.jsx(r,{message:"Change customer"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ea,{size:"xs"}),e.jsx("div",{className:"text-sm",children:t.email})]}),!!((i=t.tags)!=null&&i.length)&&e.jsx(Be,{size:"xs",className:"mt-14",children:(c=t.tags)==null?void 0:c.map(l=>e.jsx(je,{children:l.display_name},l.id))})]}),(a==null?void 0:a.enable)&&e.jsx(jn,{user:t,ticket:s})]})}function En({ticket:s}){const t=s.user,{data:a,isLoading:n}=qe({userId:t.id,perPage:6,paginate:"simple"}),i=e.jsx(W.div,{...J,children:Array.from({length:5}).map((l,o)=>e.jsx(Fe,{className:"min-h-24"},o))},"skeletons"),c=e.jsx(W.div,{...J,children:a==null?void 0:a.pagination.data.filter(l=>l.id!==s.id).map(l=>e.jsxs(Y,{type:"modal",children:[e.jsx(lt,{display:"block",className:w("block min-w-0 max-w-full overflow-hidden text-ellipsis pb-4 text-sm hover:underline",l.closed_at&&"text-muted"),children:l.subject}),e.jsx(Nn,{ticketId:l.id})]},l.id))},"tickets");return e.jsx(Ye,{label:e.jsx(r,{message:"Other tickets"}),name:"other-tickets",children:e.jsx(ee,{initial:!1,mode:"wait",children:e.jsx("div",{className:"space-y-10 px-14",children:n?i:c})})})}function Qs(){const s=B(),{updateActiveDraft:t,setEditorIsOpen:a}=E();return C({mutationFn:n=>{t({isSaving:!0});const i=n.ticketId||s.ticketId;return Mn(n.draft,i)},onSuccess:async(n,i)=>{if(i.type!=="background"){const c=i.ticketId||s.ticketId;await k.invalidateQueries({queryKey:["tickets",`${c}`]}),a(!1)}t({isDirty:!1,id:n.reply.id})},onError:n=>N(n),onSettled:()=>{t({isSaving:!1})}})}function Mn(s,t){const a={body:s.body,attachments:s.attachments.map(i=>i.id)};return(s.id?b.put(`replies/${s.id}`,a):b.post(`tickets/${t}/drafts`,a)).then(i=>i.data)}function Hs(){const s=Qs();return d.useCallback((t="background",a)=>{y().activeDraft.isDirty&&!y().activeDraft.isSaving&&!y().ticketIsSaving&&s.mutate({ticketId:a,draft:y().activeDraft,type:t})},[s])}function qn(){const{ticketId:s}=B(),{perform:t,action:a}=Xe(),n=Ss({clearTicketCache:!1}),{setTicketIsSaving:i}=E();return C({mutationFn:c=>(i(!0),On({ticketId:s,...c})),onSuccess:async()=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),y().activeDraft.id&&n.mutate({id:y().activeDraft.id}),y().discardActiveDraft(),await Promise.allSettled([k.invalidateQueries({queryKey:["tickets"],predicate:c=>a==="stay_on_page"||!$n(c,s)}),t()]),_(g("Reply submitted"))},onError:c=>N(c),onSettled:()=>i(!1)})}function On(s){return b.post(`tickets/${s.ticketId}/${s.type}`,s).then(t=>t.data)}function $n(s,t){const a=s.queryKey[0]==="tickets"&&s.queryKey[1]===`${t}`,n=s.queryKey[0]==="tickets"&&typeof s.queryKey[1]=="object"&&s.queryKey[1]&&"userId"in s.queryKey[1];return a||n}function Bn({size:s="sm"}){const t=E(u=>u.activeDraft.isDirty),a=E(u=>u.activeDraft.isSaving),n=E(u=>{var m;return!u.activeDraft.body&&!((m=u.activeDraft.attachments)!=null&&m.length)}),i=Qs(),c=Ss(),l=()=>{i.mutate({draft:y().activeDraft,type:"manual"})},o=d.useCallback(()=>{y().activeDraft.id?c.mutate({id:y().activeDraft.id},{onSuccess:()=>y().setEditorIsOpen(!1)}):y().setEditorIsOpen(!1)},[c]);return H("window","Escape",()=>{y().editorIsOpen&&o()}),e.jsxs(d.Fragment,{children:[e.jsx(ie,{label:e.jsx(r,{message:"Save draft"}),children:e.jsx(D,{className:"ml-auto",size:s,color:t?null:"positive",onClick:l,disabled:a||n,children:e.jsx(ot,{})})}),e.jsx(ie,{label:e.jsx(r,{message:"Discard (Esc)"}),children:e.jsx(D,{size:s,disabled:a,onClick:o,children:e.jsx(Ts,{})})})]})}function Un(s=""){const{user:t}=fs();return X({queryKey:["canned-replies",`${t==null?void 0:t.id}`,s],queryFn:({signal:a})=>Kn(t.id,s,a),placeholderData:ze})}async function Kn(s,t,a){return t&&await new Promise(n=>setTimeout(n,300)),b.get("canned-replies",{params:{userId:s,shared:!0,perPage:15,query:t},signal:a}).then(n=>n.data)}function Qn({onSelected:s,size:t}){const{trans:a}=fe(),[n,i]=d.useState(""),{data:c,isFetching:l}=Un(n);return e.jsxs(O,{isAsync:!0,searchPlaceholder:a(g("Search...")),isLoading:l,inputValue:n,onInputValueChange:i,clearInputOnItemSelection:!0,blurReferenceOnItemSelection:!0,selectionMode:"none",showSearchField:!0,floatingMaxHeight:440,floatingMinWidth:"min-w-288",showEmptyMessage:!0,children:[e.jsx(ie,{label:e.jsx(r,{message:"Saved replies"}),children:e.jsx(D,{size:t,children:e.jsx(sa,{})})}),e.jsxs($,{children:[e.jsx(j,{value:"saveThisReply",className:"font-semibold",onSelected:()=>R(Ut),children:e.jsx(r,{message:"Save this reply..."})}),c==null?void 0:c.pagination.data.map(o=>e.jsx(j,{value:o.id,onSelected:()=>s(o),children:o.name},o.id))]})]})}function Hn({onSelected:s}){const t=dt(),a=d.useRef(null),[n,i]=d.useState(""),{data:c,isFetching:l}=hs(n,{categoryIds:t}),{trans:o}=fe();return H("window","ctrl+/",()=>{var u;(u=a.current)==null||u.focus()},{allowedInputSelector:".ProseMirror"}),e.jsx(os,{inputValue:n,onInputValueChange:i,isAsync:!0,isLoading:l,items:c==null?void 0:c.pagination.data,clearInputOnItemSelection:!0,hideEndAdornment:!0,placeholder:o(g("Search documentation... (ctrl+/)")),startAdornment:e.jsx(xs,{}),className:"mb-10",selectionMode:"none",showEmptyMessage:!0,ref:a,children:u=>e.jsx(j,{value:u.id,onSelected:()=>{close(),s(u)},description:e.jsx(ps,{article:u}),textLabel:u.title,children:u.title},u.id)})}function Vn(){var l;const{addGlobalListener:s}=ut(),t=qn(),a=E(o=>o.activeDraft.attachments),n=d.useRef(null),i=d.useCallback(()=>{n.current&&t.mutate({type:"replies",status:mt("ticket-page-status","pending"),attachments:y().activeDraft.attachments.map(o=>o.id),body:Le(n)},{onSuccess:()=>{y().setEditorIsOpen(!1)}})},[t]),c=Hs();return d.useEffect(()=>{s(document,"visibilitychange",()=>{document.hidden&&c()})},[s,c]),e.jsxs("div",{className:"mb-24 px-20",children:[e.jsx(Hn,{onSelected:o=>{n.current&&Pt(n.current,{href:js(o),target:"_blank",text:o.title})}}),e.jsx(we,{menubarButtons:e.jsx(Wn,{editorRef:n}),footerButtons:e.jsx(Gn,{}),attachments:a,onAttachmentsChange:o=>{y().updateActiveDraft({attachments:o})},editorRef:n,onSubmit:i,isLoading:t.isPending,initialContent:(l=y().activeDraft)==null?void 0:l.body,onChange:()=>{n.current&&y().updateActiveDraft({body:n.current.getHTML()})}})]})}function Wn({size:s,editorRef:t}){return e.jsxs(d.Fragment,{children:[e.jsx(Qn,{size:s,onSelected:a=>{var n;y().updateActiveDraft({body:a.body,attachments:a.attachments}),(n=t.current)==null||n.commands.insertContent(a.body)}}),e.jsx(Bn,{size:s})]})}function Gn({isLoading:s,onSubmit:t}){return e.jsxs(d.Fragment,{children:[e.jsx(Xn,{}),e.jsx(It,{isLoading:s,onSubmit:t}),e.jsx(Jn,{disabled:s})]})}function Jn({disabled:s}){const{action:t,setAction:a}=Xe();return e.jsxs(O,{selectionMode:"single",selectedValue:t,onItemSelected:n=>a(n),children:[e.jsx(D,{border:"border border-transparent border-l-primary-light/40",variant:"flat",color:"primary",radius:"rounded-none",size:"sm",disabled:s,children:e.jsx(xt,{})}),e.jsx($,{children:Object.entries(Ha).map(([n,i])=>e.jsx(j,{value:n,capitalizeFirst:!0,children:e.jsx(r,{...i})},n))})]})}function Xn(){const{data:s}=le(),[t,a]=Re("ticket-page-status","pending");if(!(s!=null&&s.statusTags.length))return null;const n=s.statusTags.find(i=>i.name===t);return e.jsxs(O,{selectionMode:"single",selectedValue:t,onItemSelected:i=>a(i),children:[e.jsx(h,{radius:"rounded-none",endIcon:e.jsx(pe,{}),className:"capitalize text-muted",children:n?e.jsx(r,{message:n.display_name}):e.jsx(r,{message:"Select status"})}),e.jsx($,{children:s.statusTags.map(i=>e.jsx(j,{value:i.name,capitalizeFirst:!0,children:e.jsx(r,{message:i.display_name})},i.id))})]})}function Yn(){return e.jsx(Ce,{rightSidenav:e.jsx(He,{position:"right",className:"bg-alt",size:"w-264",children:e.jsx(zn,{})}),children:e.jsx(Zn,{})})}function Zn(){var i;const{branding:s}=se(),t=Ee(),a=Gt((i=t.data)==null?void 0:i.ticket.id),n=Hs();return d.useEffect(()=>{var l,o;const c=(l=t.data)==null?void 0:l.ticket;if(c){const u=(o=c.replies)==null?void 0:o.find(m=>m.type==="drafts");u&&a!==c.id&&y().updateActiveDraft({...Dt,...u,isDirty:!1})}return()=>{a&&(n("manual",a),y().setEditorIsOpen(!1))}},[a]),e.jsx(d.Fragment,{children:t.data?e.jsxs(d.Fragment,{children:[e.jsx(gt,{children:e.jsxs("title",{children:[t.data.ticket.subject," - ",s.site_name]})}),e.jsx(Ja,{ticket:t.data.ticket}),e.jsx(gn,{data:t.data}),e.jsx(ei,{}),e.jsx(dn,{data:t.data})]}):e.jsx(be,{query:t,loaderClassName:"absolute inset-0 m-auto",redirectOn404:"/agent/tickets"})})}function ei(){const s=E(t=>t.editorIsOpen);return e.jsx(ye,{children:s&&e.jsx(Vn,{})})}function si(){const{user:s}=fs();return e.jsx(Ce,{children:e.jsx(Kt,{userId:s==null?void 0:s.id})})}function ti(){const s=le();return e.jsx(Ce,{children:e.jsxs("main",{className:"container mx-auto p-12 md:p-24",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(r,{message:"Create new ticket"})}),s.data?e.jsx(ai,{tags:s.data}):e.jsx(be,{query:s,show404:!1,loaderIsScreen:!1})]})})}function ai({tags:{statusTags:s,categoryTags:t}}){var f,U,I;const a=F(),[n]=q(),i=n.get("customer_id"),c=ve({defaultValues:{category_id:(f=t[0])==null?void 0:f.id,status:(U=s[0])==null?void 0:U.name,user_id:i?parseInt(i):void 0}}),l=(I=c.formState.errors.body)==null?void 0:I.message,o=_t(c),u=d.useRef(null),[m,v]=d.useState([]),p=()=>{o.mutate({...c.getValues(),body:Le(u)||"",attachments:m.map(x=>x.id),created_by_agent:!0},{onSuccess:()=>a("/agent/tickets")})},S=ht();return e.jsxs(ke,{form:c,onSubmit:()=>p(),onBeforeSubmit:()=>c.clearErrors(),children:[e.jsx(Qe,{name:"user_id",endpoint:"normalized-models/user",label:e.jsx(r,{message:"Customer"}),className:"mb-24",autoFocus:!0}),e.jsx(Se,{name:"subject",label:e.jsx(r,{message:"Subject"}),className:"mb-24"}),e.jsx(he,{name:"category_id",label:e.jsx(r,{message:"Category"}),selectionMode:"single",className:"mb-24",children:t.map(x=>e.jsx(j,{value:x.id,children:x.display_name||x.name},x.id))}),e.jsx(he,{name:"status",label:e.jsx(r,{message:"Status"}),selectionMode:"single",className:"mb-24",children:s.map(x=>e.jsx(j,{value:x.name,children:x.display_name||x.name},x.id))}),e.jsxs("div",{className:"mb-24",children:[e.jsx("div",{className:S.label,children:e.jsx(r,{message:"Reply body"})}),e.jsx(ye,{children:e.jsx(we,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:o.isPending,editorRef:u,attachments:m,onAttachmentsChange:x=>v(x),onSubmit:()=>p()})}),l&&e.jsx("div",{className:S.error,children:l})]}),e.jsx(h,{variant:"flat",color:"primary",type:"submit",disabled:o.isPending,children:e.jsx(r,{message:"Create"})})]})}function ni(s,t){return C({mutationFn:a=>ii(s,a),onSuccess:async()=>{t.reset({},{keepValues:!0}),await k.invalidateQueries({queryKey:["users"]}),_(g("User details updated"))},onError:a=>t?ys(a,t):N(a)})}function ii(s,t){return b.put(`users/${s}/details`,t).then(a=>a.data)}const V="border border-fg-base/6 hover:border-divider";function ri({user:s,className:t}){const{envato:a}=se();return e.jsxs("aside",{className:t,children:[s&&e.jsx(ci,{user:s}),(a==null?void 0:a.enable)&&!!(s!=null&&s.purchase_codes)&&e.jsxs(d.Fragment,{children:[e.jsx("div",{className:"mb-4 mt-24 text-lg font-semibold",children:e.jsx(r,{message:"Envato purchases"})}),e.jsx(Ks,{purchases:s.purchase_codes})]})]})}function ci({user:s}){var n,i,c;const t=ve({defaultValues:{language:s.language||"",country:s.country||"",timezone:s.timezone||jt(),notes:((n=s.details)==null?void 0:n.notes)||"",details:((i=s.details)==null?void 0:i.details)||"",emails:s.secondary_emails,tags:(c=s.tags)==null?void 0:c.map(l=>l.name)}}),a=ni(s.id,t);return e.jsxs(ke,{form:t,onSubmit:l=>a.mutate(l),children:[e.jsxs("div",{className:"space-y-12",children:[e.jsx(li,{user:s}),e.jsx(oi,{user:s}),e.jsx(M,{label:e.jsx(r,{message:"Tags"}),children:e.jsx(Qt,{name:"tags",size:"sm",chipSize:"xs",valueKey:"name",inputBorder:V})}),e.jsx(di,{}),e.jsx(ui,{}),e.jsx(M,{label:e.jsx(r,{message:"Last login"}),children:s.last_login?e.jsx(z,{date:s.last_login.created_at}):"-"}),e.jsx(M,{label:e.jsx(r,{message:"Created at"}),children:s.created_at?e.jsx(z,{date:s.created_at}):"-"})]}),t.formState.isDirty&&e.jsx(h,{color:"primary",variant:"flat",type:"submit",size:"sm",display:"block",className:"mt-14 w-full",disabled:a.isPending,children:e.jsx(r,{message:"Save"})})]})}function li({user:s}){const{fields:t,append:a,remove:n}=pt({name:"emails",keyName:"key"});return e.jsx(M,{label:e.jsx("div",{className:"mt-4",children:e.jsx(r,{message:"Emails"})}),align:"items-start",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-12",children:[e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:s.email}),e.jsx(ie,{label:e.jsx(r,{message:"Add email"}),children:e.jsx(D,{size:"xs",iconSize:"sm",onClick:()=>a({address:""}),children:e.jsx(Is,{})})})]}),e.jsx("div",{className:"space-y-4 pt-6",children:t.map((i,c)=>e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(Se,{name:`emails.${c}.address`,className:"flex-auto",size:"xs",type:"email",inputBorder:V}),e.jsx(D,{color:"danger",size:"xs",iconSize:"sm",onClick:()=>n(c),children:e.jsx(ft,{})})]},i.key))})]})})}function oi({user:s}){const{trans:t}=fe(),{data:a}=yt(["timezones","countries","localizations"]),n=(a==null?void 0:a.countries)||[],i=(a==null?void 0:a.localizations)||[],c=(a==null?void 0:a.timezones)||{};return e.jsxs(d.Fragment,{children:[e.jsx(M,{label:e.jsx(r,{message:"Timezone"}),children:e.jsx(bt,{name:"timezone",timezones:c,size:"sm",inputBorder:V})}),e.jsx(M,{label:e.jsx(r,{message:"Language"}),children:e.jsx(he,{selectionMode:"single",name:"language",size:"sm",inputBorder:V,children:i.map(l=>e.jsx(j,{value:l.language,children:l.name},l.language))})}),e.jsx(M,{label:e.jsx(r,{message:"Country"}),children:e.jsx(he,{selectionMode:"single",size:"sm",name:"country",showSearchField:!0,searchPlaceholder:t(g("Search countries")),inputBorder:V,children:n.map(l=>e.jsx(j,{value:l.code,children:l.name},l.code))})})]})}function di(){return e.jsx(M,{label:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{children:e.jsx(r,{message:"Details"})}),e.jsx(Ds,{dialogSize:"xs",body:e.jsx(r,{message:"Optional information, like address. Only visible to agents, not end users."})})]}),children:e.jsx(Se,{name:"details",inputElementType:"textarea",rows:1,inputBorder:V})})}function ui(){return e.jsx(M,{label:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{children:e.jsx(r,{message:"Notes"})}),e.jsx(Ds,{dialogSize:"xs",body:e.jsx(r,{message:"Optional notes. Only visible to agents, not end users."})})]}),children:e.jsx(Se,{name:"notes",inputElementType:"textarea",rows:1,inputBorder:V})})}function M({label:s,children:t,align:a="items-center"}){return e.jsxs("div",{className:`flex ${a} gap-12`,children:[e.jsx("div",{className:"w-80 flex-shrink-0 text-sm text-muted",children:s}),e.jsx("div",{className:"min-w-0 flex-auto text-sm",children:t})]})}function mi(){const s=F();return C({mutationFn:xi,onSuccess:async()=>{_(g("User deleted")),await Promise.allSettled([k.invalidateQueries({queryKey:["users"]}),k.invalidateQueries({queryKey:["tickets"]})]),s("/agent/tickets")},onError:t=>N(t)})}function xi(s){return b.delete(`users/${s.userId}`).then(t=>t.data)}function gi(s){const t=F();return C({mutationFn:hi,onSuccess:async()=>{_(g("Users merged")),await Promise.allSettled([k.invalidateQueries({queryKey:["users"]}),k.invalidateQueries({queryKey:["tickets"]})]),t("/agent/tickets")},onError:a=>ys(a,s)})}function hi(s){return b.post("merge-users",s).then(t=>t.data)}function ji({mergee:s}){const{close:t,formId:a}=A(),n=ve({defaultValues:{mergee_id:s.id}}),i=gi(n),c=n.watch("user_id");return e.jsxs(K,{children:[e.jsx(G,{children:e.jsx(r,{message:"Merge ':name' into another user",values:{name:s.display_name}})}),e.jsx(Q,{children:e.jsx(ke,{id:a,form:n,onSubmit:l=>{i.mutate(l,{onSuccess:()=>t()})},children:e.jsx(Qe,{name:"user_id",endpoint:"normalized-models/user",label:e.jsx(r,{message:"User to merge into"}),placeholder:g("Select user"),description:e.jsx(r,{message:"':name' will be deleted and all data belonging to them will be merged into selected user.",values:{name:s.display_name}})})})}),e.jsxs(Z,{children:[e.jsx(h,{onClick:()=>t(),children:e.jsx(r,{message:"Cancel"})}),e.jsx(h,{type:"submit",variant:"flat",color:"primary",form:a,disabled:!c||i.isPending,children:e.jsx(r,{message:"Merge"})})]})]})}function pi(){var n;const{userId:s}=B(),t=vt(s,{with:["tags","secondary_emails","details","purchase_codes","bans","lastLogin"]}),a=(n=t.data)==null?void 0:n.user;return d.useEffect(()=>{kt(["timezones","countries","localizations"])},[]),!t.isLoading&&!t.data?e.jsx(be,{query:t}):e.jsxs(_s,{name:"agent_customer_page",children:[e.jsx(Ge,{element:As}),e.jsx(fi,{user:a}),e.jsx(Ps,{children:e.jsx("main",{className:w("p-14 transition-opacity md:p-24",!a&&"opacity-0"),children:e.jsxs(d.Fragment,{children:[e.jsx(yi,{user:a}),e.jsx(vi,{})]})})})]})}function fi({user:s}){const{isMobileMode:t}=d.useContext(Jt);return e.jsx(He,{position:"left",size:"w-350",className:w("bg",t?"border-r p-12":"mt-8 py-24 pl-24"),overflow:"overflow-y-auto overflow-x-hidden compact-scrollbar",children:e.jsx(ri,{user:s})})}function yi({user:s}){var a,n;if(!s)return null;const t=(n=(a=s.bans)==null?void 0:a[0])==null?void 0:n.comment;return e.jsxs("header",{className:"mb-16 flex items-center",children:[e.jsxs("div",{className:"mr-auto flex items-center gap-14",children:[e.jsx(Me,{user:s,size:"w-50 h-50",circle:!0}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:s.display_name}),t&&e.jsx("div",{className:"text-sm text-danger",children:e.jsx(r,{message:"Suspended: :reason",values:{reason:t}})})]})]}),e.jsx(h,{variant:"outline",startIcon:e.jsx(Is,{}),size:"xs",className:"mx-12",elementType:P,to:`/agent/tickets/new?customer_id=${s.id}`,target:"_blank",children:e.jsx(r,{message:"New ticket"})}),e.jsxs(O,{children:[e.jsx(D,{variant:"outline",size:"xs",children:e.jsx(aa,{})}),e.jsxs($,{children:[e.jsx(j,{value:"suspend",onSelected:()=>R(Ht,{user:s}),children:e.jsx(r,{message:"Suspend"})}),e.jsx(j,{value:"merge",onSelected:()=>R(ji,{mergee:s}),children:e.jsx(r,{message:"Merge into another user"})}),e.jsx(j,{value:"delete",onSelected:()=>R(bi,{user:s}),children:e.jsx(r,{message:"Delete"})})]})]})]})}function bi({user:s}){const t=mi(),{close:a}=A();return e.jsx(ce,{isDanger:!0,title:e.jsx(r,{message:"Delete user"}),body:e.jsx(r,{message:"Are you sure you want to delete this user? This will also delete all tickets created by this user and can't be undone."}),onConfirm:()=>{t.mutate({userId:s.id},{onSuccess:()=>a()})},isLoading:t.isPending,confirm:e.jsx(r,{message:"Delete"})})}function vi(){const{userId:s}=B(),{pathname:t}=ms(),[a,n]=d.useState(()=>t.endsWith("searches")?1:0);return e.jsx("div",{className:"rounded border",children:e.jsxs(Cs,{selectedTab:a,onTabChange:n,children:[e.jsxs(Ns,{children:[e.jsx(Ae,{width:"min-w-132",elementType:P,to:_e(s),replace:!0,children:e.jsx(r,{message:"Tickets"})}),e.jsx(Ae,{width:"min-w-132",elementType:P,to:_e(s,{tab:"searches"}),replace:!0,children:e.jsx(r,{message:"Searches"})})]}),e.jsx("div",{children:e.jsx(gs,{})})]})})}function ki(){const[s,t]=q(),{userId:a}=B(),[n,i]=d.useState([]),c=qe({userId:a,page:s.get("page")||1,perPage:s.get("perPage")??"",loader:"ticketTable"}),{data:l,fetchStatus:o,isLoading:u,isPlaceholderData:m}=c,v=(l==null?void 0:l.pagination.data)||[],p=o==="idle"&&v.length===0||!u&&!m&&v.length===0;return e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{query:c}),e.jsx(Ve,{query:c,selectedTickets:n,onSelectionChange:i}),e.jsx(ee,{children:n.length&&e.jsx(We,{ticketIds:n,onActionCompleted:()=>i([])})}),p&&e.jsx(Pe,{className:"mt-48",image:e.jsx(ds,{src:Fs}),title:e.jsx(r,{message:"User has not created any tickets yet"})}),e.jsx($e,{query:c,onPageChange:S=>t(f=>(f.set("page",S.toString()),f)),onPerPageChange:S=>t(f=>(f.set("perPage",S.toString()),f))})]})}function Si(){const{userId:s}=B();return e.jsx(Vt,{description:e.jsx(r,{message:"This report shows what the user searched for recently."}),userId:s,orderBy:"last_seen"})}const wi=[{path:"/",element:e.jsx(ss,{to:"/agent/tickets",replace:!0})},{path:"/tickets",element:e.jsx(_a,{})},{path:"/tickets/new",element:e.jsx(ti,{})},{path:"/tickets/:ticketId",element:e.jsx(Yn,{})},{path:"/users/:userId",element:e.jsx(pi,{}),children:[{path:"",element:e.jsx(ss,{to:"tickets",replace:!0})},{path:"tickets",element:e.jsx(ki,{})},{path:"searches",element:e.jsx(Si,{})}]},{path:"/search",element:e.jsx(za,{}),children:[{path:"",element:e.jsx(rs,{})},{path:"tickets",element:e.jsx(rs,{})},{path:"users",element:e.jsx($a,{})},{path:"articles",element:e.jsx(Ua,{})}]},{path:"saved-replies",element:e.jsx(si,{})},{path:"*",element:e.jsx(wt,{})}];function Fi(){return St(wi)}export{Fi as default};
//# sourceMappingURL=agent-routes-86c2746c.js.map
